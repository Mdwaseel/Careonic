{% extends 'app/base.html' %}
{% block title %}Health Report{% endblock %}
{% block content %}
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <div>
                <h3 class="mb-0">Health Report for {{ name }}</h3>
                <p class="mb-0">Age: {{ age }} | Gender: {{ gender }} | Current Weight: {{ current_weight }} kg</p>
            </div>
            <div>
                <a href="{% url 'download_report' %}" class="btn btn-light btn-sm" target="_blank">
                    <i class="bi bi-file-earmark-pdf"></i> Download PDF
                </a>
            </div>
        </div>

                <div class="card-body">
                    <h4 class="mb-3">Data Tables (Last 30 Days)</h4>
                    <h5>BP Measurements</h5>
                    {% if bp_data %}
                        <div class="table-responsive mb-4">
                            <table class="table table-striped table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th>Date</th>
                                        <th>Systolic BP</th>
                                        <th>Diastolic BP</th>
                                        <th>Heart Rate</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in bp_data %}
                                        <tr>
                                            <td>{{ entry.measurement_date|date:"F d, Y" }}</td>
                                            <td>{{ entry.systolic_bp }}</td>
                                            <td>{{ entry.diastolic_bp }}</td>
                                            <td>{{ entry.heart_rate|default:"N/A" }}</td>
                                            <td>{{ entry.notes|default:"None" }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <p>Average: {{ bp_summary.avg_systolic|floatformat:0 }} / {{ bp_summary.avg_diastolic|floatformat:0 }} mmHg, Avg HR: {{ bp_summary.avg_heart_rate|default:"N/A" }}</p>
                    {% else %}
                        <p class="text-muted">No BP data available.</p>
                    {% endif %}

                    <h5>Weight Logs</h5>
                    {% if weight_data %}
                        <div class="table-responsive mb-4">
                            <table class="table table-striped table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th>Date</th>
                                        <th>Weight (kg)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in weight_data %}
                                        <tr>
                                            <td>{{ entry.log_date|date:"F d, Y" }}</td>
                                            <td>{{ entry.weight }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <p>Average Weight: {{ weight_summary.avg_weight|default:"N/A"|floatformat:1 }} kg</p>

                    {% else %}
                        <p class="text-muted">No weight data available.</p>
                    {% endif %}

                    <h5>Diet Logs</h5>
                    {% if diet_data %}
                        <div class="table-responsive mb-4">
                            <table class="table table-striped table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th>Date</th>
                                        <th>Sodium (mg)</th>
                                        <th>Potassium (mg)</th>
                                        <th>Carbs (g)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in diet_data %}
                                        <tr>
                                            <td>{{ entry.log_date|date:"F d, Y" }}</td>
                                            <td>{{ entry.sodium_intake }}</td>
                                            <td>{{ entry.potassium_intake }}</td>
                                            <td>{{ entry.carb_intake }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <p>Average Sodium: {{ diet_summary.avg_sodium|floatformat:0 }} mg, Potassium: {{ diet_summary.avg_potassium|floatformat:0 }} mg, Carbs: {{ diet_summary.avg_carb|floatformat:0 }} g</p>
                    {% else %}
                        <p class="text-muted">No diet data available.</p>
                    {% endif %}

                    <h5>Symptoms</h5>
                    {% if symptom_data %}
                        <div class="table-responsive mb-4">
                            <table class="table table-striped table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Severity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in symptom_data %}
                                        <tr>
                                            <td>{{ entry.log_date|date:"F d, Y" }}</td>
                                            <td>{{ entry.symptom_description }}</td>
                                            <td>{{ entry.severity }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <ul>
                            {% for item in symptom_summary %}
                                <li>{{ item.severity }}: {{ item.count }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">No symptom data available.</p>
                    {% endif %}

                    <h4 class="mb-3">Trend Graphs (Over Time)</h4>
                    {% if bp_graph %}
                        <h5>BP Trends</h5>
                        <img src="data:image/png;base64,{{ bp_graph }}" alt="BP Trends Graph" class="img-fluid mb-4">
                    {% endif %}

                    {% if weight_graph %}
                        <h5>Weight Trends</h5>
                        <img src="data:image/png;base64,{{ weight_graph }}" alt="Weight Trends Graph" class="img-fluid mb-4">
                    {% endif %}

                    {% if diet_graph %}
                        <h5>Diet Trends</h5>
                        <img src="data:image/png;base64,{{ diet_graph }}" alt="Diet Trends Graph" class="img-fluid mb-4">
                    {% endif %}

                    {% if symptom_graph %}
                        <h5>Symptoms Severity Count</h5>
                        <img src="data:image/png;base64,{{ symptom_graph }}" alt="Symptoms Graph" class="img-fluid mb-4">
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}